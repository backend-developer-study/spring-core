
# ìŠ¤í”„ë§ì˜ ê°•ì˜ ë¦¬ë·°ğŸ“½
> LoadMap Part : ìŠ¤í”„ë§ í•µì‹¬ì›ë¦¬ - ê¸°ë³¸í¸   
> Section : 08.ë¹ˆ ìƒëª…ì£¼ê¸° ì½œë°±  
> CreateDate : 2022.06.21   
> UpdateDate : 2022.06.


### ëª©ì°¨
- [ë¹ˆ ìƒëª…ì£¼ê¸° ì½œë°± ì‹œì‘](#beanLifeCyle)
- [ì¸í„°í˜ì´ìŠ¤ InitializingBean, DisposableBean](#interface)
- [ë¹ˆ ë“±ë¡ ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œ ì§€ì •](#configSetting)
- [ì• ë…¸í…Œì´ì…˜ @PostConstruct, @PreDestroy](#annotation)

<br></br>
<br></br>

# 1.ë¹ˆ ìƒëª…ì£¼ê¸° ì½œë°± ì‹œì‘<a name="beanLifeCyle"></a>
> ë¹ˆì´ ìƒì„±ë˜ê³  ì¢…ë£Œë˜ëŠ” ê²ƒì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ê´€ë¦¬í•˜ëŠ”ê²Œ ì•„ë‹Œê°€? ê·¸ëŸ¼ êµ³ì´ ìƒëª…ì£¼ê¸°ë¥¼ ì•Œ í•„ìš”ê°€ ìˆì„ê¹Œ?     
> ë¬¼ë¡ , ë§ë‹¤. ë³´í†µì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ìë™ìœ¼ë¡œ ê´€ë¦¬í•´ì£¼ì§€ë§Œ,  
> ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ì´ë‚˜, ë„¤íŠ¸ì›Œí¬ ì†Œì¼“ì²˜ëŸ¼ ì‹œì‘ì§€ì ì— í•„ìš”í•œ ì—°ê²°ì„ ë¯¸ë¦¬í•´ë‘ê³ , ì¢…ë£Œì‹œì ì— ì—°ê²°ì„ ëª¨ë‘ ì¢…ë£Œí•´ì•¼í•˜ëŠ” ì‘ì—…ì„
> í•  ë•Œì—ëŠ”, ê°ì²´ì˜ ì´ˆê¸°í™” ì™€ ì¢…ë£Œ ì‘ì—…ì´ í•„ìš”í•˜ë‹¤. 

- ë‚´ê°€ ìƒê°í–ˆì„ ë•Œ, ë¹ˆì„ ë¨¼ì € ë§Œë“¤ê³ , ì´ˆê¸°í™”í•´ì¤˜ì•¼ ë˜ëŠ” ê²½ìš°
<img src="https://user-images.githubusercontent.com/104331549/174960916-bbdec41e-09df-4b25-bd23-f28132c08a55.png">


- ìŠ¤í”„ë§ ë¹ˆì€ ê°„ë‹¨í•˜ê²Œ `ê°ì²´ ìƒì„±  -> ì˜ì¡´ê´€ê³„ ì£¼ì…` ê³¼ ê°™ì€ ë¼ì´í”„ì‚¬ì´í´ì„ ê°€ì§„ë‹¤.
- ì´ˆê¸°í™” ì‘ì—…ì€ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ëª¨ë‘ ì™„ë£Œë˜ê³  ë‚œ ë‹¤ìŒì— í˜¸ì¶œí•´ì•¼ í•œë‹¤. 
- ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë²¤íŠ¸ ë¼ì´í”„ì‚¬ì´í´
    - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒì„± -> ìŠ¤í”„ë§ ë¹ˆ ìƒì„± -> ì˜ì¡´ê´€ê³„ ì£¼ì… -> ì´ˆê¸°í™” ì½œë°± -> ì‚¬ìš© -> ì†Œë©¸ì „ ì½œë°± -> ìŠ¤í”„ë§ ì¢…ë£Œ


ìŠ¤í”„ë§ì—ì„œë„ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ì™„ë£Œë˜ë©´ ìŠ¤í”„ë§ ë¹ˆì—ê²Œ ì½œë°± ë©”ì„œë“œë¥¼ í†µí•´ì„œ ì´ˆê¸°í™” ì‹œì ì„ ì•Œë ¤ì£¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.   
ì´ëŸ¬í•œ ê¸°ëŠ¥ì€ í¬ê²Œ 3ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤. 
1. ì¸í„°í˜ì´ìŠ¤ InitializingBean, DisposableBean
2. ì„¤ì • ì •ë³´ì— ë¹ˆ ë“±ë¡ ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œ ì§€ì •
3.  @PostConstruct, @PreDestroy ì• ë…¸í…Œì´ì…˜

> ìƒëª…ì£¼ê¸° ê´€ë ¨í•´ì„œ ìì„¸í•œ ë‚´ìš”ì€ ìŠ¤ì½”í”„ì—ì„œ ì•Œì•„ë³¸ë‹¤.

<br></br>
<br></br>
# 2. ì¸í„°í˜ì´ìŠ¤  InitializingBean, DisposableBean<a name="interface"></a>
> ê°€ìƒì˜ í´ë¼ì´ì–¸íŠ¸ê°€ ë„¤íŠ¸ì›Œí¬ìš”ì²­ì„ í–ˆë‹¤ê³  ê°€ì •

- NetworkClient.java
```java
public class NetworkClient implements InitializingBean, DisposableBean {
    private String url;

    public NetworkClient() {
        System.out.println("ìƒì„±ì í˜¸ì¶œ, url = " + url);

    }

    public void setUrl(String url) {
        this.url = url;
    }

    //ì„œë¹„ìŠ¤ ì‹œì‘ì‹œ í˜¸ì¶œ
    private void call(String message) {
        System.out.println("call: " + url + " message = " + message);

    }

    private void connect() {
        System.out.println("connect: " + url);

    }
    //ì„œë¹„ìŠ¤ ì¢…ë£Œì‹œ í˜¸ì¶œ
    public void disconnect() {
        System.out.println("close: " + url);
    }

    @Override
    public void afterPropertiesSet() throws Exception {
        System.out.println("NetworkClient.afterPropertiesSet");
        connect();
        call("ì´ˆê¸°í™” ì—°ê²° ë©”ì‹œì§€");
    }

    @Override
    public void destroy() throws Exception {
        System.out.println("NetworkClient.destroy");
        disconnect();
    }
}
```
- BeanLifeCycleTest.java
```java
public class BeanLifeCycleTest {

    @Test
    public void lifeCycleTest(){
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(LifeCycleConfig.class);
        NetworkClient client = ac.getBean(NetworkClient.class);
        ac.close(); // ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ë‹«ì•„ì¤Œ
    }

    @Configuration
    static class LifeCycleConfig{
        @Bean
        public NetworkClient networkClient(){
            NetworkClient networkClient = new NetworkClient();
            networkClient.setUrl("https://docs.spring.io");
            return networkClient;
        }
    }
}
```
- ì¶œë ¥ ê²°ê³¼
```
ìƒì„±ì í˜¸ì¶œ, url = null
NetworkClient.afterPropertiesSet
connect: https://docs.spring.io
call: https://docs.spring.io message = ì´ˆê¸°í™” ì—°ê²° ë©”ì‹œì§€
16:06:51.846 [main] DEBUG org.springframework.context.annotation.AnnotationConfigApplicationContext - Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@47d9a273, started on Wed Jun 22 16:06:51 KST 2022
NetworkClient.destroy
close: https://docs.spring.io
```
 - `InitializingBean`ì¸í„°í˜ì´ìŠ¤ëŠ” `afterPropertiesSet()`ë©”ì„œë“œë¡œ ì´ˆê¸°í™”ë¥¼ ì§€ì›í•œë‹¤.
 - `DisposableBean`ì¸í„°í˜ì´ìŠ¤ëŠ” `destroy()`ë©”ì„œë“œë¡œ ì†Œë©¸ì„ ì§€ì›í•œë‹¤
 - ìŠ¤í”„ë§ì»¨í…Œì´ë„ˆ `ac.close()`ë©”ì†Œë“œë¥¼ ì•ˆì „í•˜ê²Œ í˜¸ì¶œì´ ê°€ëŠ¥í•˜ë‹¤.

### ì´ˆê¸°í™”, ì†Œë©¸ ì¸í„°í˜ì´ìŠ¤ ë‹¨ì 
 - ë‘ ì¸í„°í˜ì´ìŠ¤ ë‹¤ ìŠ¤í”„ë§ ì „ìš© ì¸í„°í˜ì´ìŠ¤ë¼ì„œ, í•´ë‹¹ì½”ë“œê°€ ìŠ¤í”„ë§ì— ì˜ì¡´í•˜ê²Œëœë‹¤.
 - ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œì˜ ì´ë¦„ì„ ë³€ê²½í•  ìˆ˜ ì—†ë‹¤
 - ë‚´ê°€ ì½”ë“œë¥¼ ê³ ì¹  ìˆ˜ ì—†ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì ìš©í•  ìˆ˜ ì—†ë‹¤.

> ì´ê²ƒë“¤ì€ ì´ˆì°½ê¸°ë•Œ ë§Œë“¤ì–´ì§„ ë°©ë²•ìœ¼ë¡œ(2003ë…„), í˜„ì¬ëŠ” ë” ì¢‹ì€ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©° ì¸í„°í˜ì´ìŠ¤ ë°©ë²•ì€ ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.


<br></br>
<br></br>

# 3.ë¹ˆ ë“±ë¡ ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œ ì§€ì • <a name="configSetting"></a>
 - ì„¤ì • ì •ë³´ì— `@Bean(initMethod = "ìƒì„±ì‹œ ì´ˆê¸°í™”í•  ë©”ì„œë“œ", destroyMethod = "ì¢…ë£Œì‹œ ë‹«ì„ ë©”ì„œë“œ")` ìœ¼ë¡œ ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œë¥¼
 ì§€ì •í•  ìˆ˜ ìˆë‹¤.

```java
public class BeanLifeCycleTest {

    @Test
    public void lifeCycleTest(){
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(LifeCycleConfig.class);
        NetworkClient client = ac.getBean(NetworkClient.class);
        ac.close(); // ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ë‹«ì•„ì¤Œ
    }

    @Configuration
    static class LifeCycleConfig{
        @Bean(initMethod = "init", destroyMethod = "close") // ë°”ë€ ë¶€ë¶„
        public NetworkClient networkClient(){
            NetworkClient networkClient = new NetworkClient();
            networkClient.setUrl("https://docs.spring.io");
            return networkClient;
        }
    }
}
```

### ì„¤ì • ì •ë³´ ì‚¬ìš© íŠ¹ì§•
- ë©”ì„œë“œ ì´ë¦„ì„ ììœ ë¡­ê²Œ ì¤„ ìˆ˜ ìˆë‹¤.
- ìŠ¤í”„ë§ ë¹ˆì´ ìŠ¤í”„ë§ ì½”ë“œì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ì½”ë“œê°€ ì•„ë‹ˆë¼ ì„¤ì • ì •ë³´ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì½”ë“œë¥¼ ê³ ì¹  ìˆ˜ ì—†ëŠ” **ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬**ì—ë„ ì´ˆê¸°í™”, ì¢…ë£Œ ë©”ì„œë“œë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤

### ì¢…ë£Œ ë©”ì„œë“œ ì¶”ë¡ !
 - `@Bean`ì˜ `destroyMethod` ëŠ” ê¸°ë³¸ê°’(default)ì´ `"(inferred)"` (ì¶”ë¡ )ìœ¼ë¡œ ë“±ë¡ë˜ì–´ ìˆë‹¤
 - ì´ ì¶”ë¡  ê¸°ëŠ¥ì€ `close` , `shutdown` ë¼ëŠ” ì´ë¦„ì˜ ë©”ì„œë“œë¥¼ ìë™ìœ¼ë¡œ í˜¸ì¶œí•´ì¤€ë‹¤.
   - (ì™¸ë¶€)ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ëŒ€ë¶€ë¶„ì€ `close` ,`shutdown`ì´ë¼ëŠ” ì´ë¦„ì˜ ì¢…ë£Œë©”ì„œë“œë¥¼ ì‚¬ìš©í•œë‹¤.
   - ì¦‰, ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ë©´ ìƒëµ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì˜ë¯¸ë‹¤.
```java
@Bean(initMethod = "init" ) // ì¢…ë£Œë©”ì„œë“œ ì‹¤í–‰ë¨
public NetworkClient networkClient(){
    NetworkClient networkClient = new NetworkClient();
    networkClient.setUrl("https://docs.spring.io");
    return networkClient;
}
```

<br></br>
<br></br>

# 4. @PostConstruct, @PreDestroy<a name="annotation"></a>
 - ê²°ë¡  ë¶€í„° ë§í•˜ìë©´, ì´ê²ƒì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```java
    @PostConstruct
    public void init(){
        System.out.println("NetworkClient.init");
        connect();
        call("ì´ˆê¸°í™” ì—°ê²° ë©”ì‹œì§€");
    }

    @PreDestroy
    public void close(){
        System.out.println("NetworkClient.close");
        disconnect();
    }
```
### íŠ¹ì§• 
 - ì• ë…¸í…Œì´ì…˜ë§Œ ë¶™ì´ë©´ ëœë‹¤.
 - JSR-250ì´ë¼ëŠ” ìë°” í‘œì¤€ì´ë‹¤. ìŠ¤í”„ë§ì´ ì•„ë‹Œ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œë„ ë™ì‘í•œë‹¤. 
 - ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ê³¼ ì˜ ì–´ìš¸ë¦°ë‹¤.(ë¹ˆì— ë³„ë„ì˜ ì„¤ì •ì´ ì—†ê¸°ë•Œë¬¸ì—)
 - ìœ ì¼í•œ ë‹¨ì !
   - ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ëŠ” ì ìš©í•˜ì§€ ëª»í•œë‹¤ëŠ” ê²ƒ

## ëŠë‚€ì  ğŸ˜Œ
### ì •ë¦¬ 
 - @PostConstruct, @PreDestroy ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì
 - ì™¸ë¶€ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì ìš©í•´ì•¼í•˜ëŠ” ê²½ìš°ëŠ” Beanì˜ ì„¤ì •ì •ë³´ë¡œ ì‚¬ìš©í•˜ì.

### ì°¸ê³  ë§í¬
 - DB Connection Pool [tistoryë¸”ë¡œê·¸](https://steady-coding.tistory.com/564)
 - ë„¤íŠ¸ì›Œí¬ ì†Œì¼“ [velog](https://velog.io/@devsh/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EA%B8%B0%EC%B4%88-%EA%B0%9C%EB%85%90-%EC%A0%95%EB%A6%AC%ED%95%98%EA%B8%B0-%EC%86%8C%EC%BC%93%EA%B3%BC-%EC%86%8C%EC%BC%93-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%EA%B0%9C%EB%85%90)